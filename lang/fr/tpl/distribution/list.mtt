<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Liste d'émargement</title>
	<style>
	
	body{
		font-family:'Arial';
		font-size:12px;
	}
	
	table{
		border-collapse: collapse;
	}
	
	table tr td{
		margin:0;
		padding:4px;
		
		text-align:left;
	}
	table tr.order td{
		border:solid 1px #DDD;
	}
	
	table tr th{
		background-color:#DDD;
		text-align:left;
	}
	
	h1, h2{
		margin:auto;
		text-align:center;
	}
	
	</style>
</head>
<body>
	
	::set date = getDate(distrib.date)::
	<h2>Livraison du ::date.dow:: ::date.d:: ::date.m::</h2>
	
	
	
	<h2>::distrib._contract.name:: - ::distrib._contract._vendor.name::</h2>	
	
	<p>
		::set c = contract._contact::
		::set v = contract._vendor::
		<b>Responsable contrat : </b>  ::c.firstName:: ::c.lastName::, ::c.email::, ::c.phone::
	</p>
	<p>
		<b>Producteur : </b>::v.name:: , 
		::if v.email!=null :: ::v.email:: ::end::, 
		::if v.phone!=null :: ::v.phone:: ::end::
	</p>
	<p>	
		<b>De permanence : </b>
		::if distrib._distributor1!=null:: ::distrib._distributor1.getName()::,::end::
		::if distrib._distributor2!=null:: ::distrib._distributor2.getName()::,::end::
		::if distrib._distributor3!=null:: ::distrib._distributor3.getName()::,::end::
		::if distrib._distributor4!=null:: ::distrib._distributor4.getName():: ::end::
		
	</p>
	
		<table class="table table-bordered table-hover"  style="width:100%;">
				::set total = 0:: <!-- big total -->
				::set subtotal = 0:: <!-- total per user -->
				
				::foreach m orders::	
				
					::set i = repeat.m.index::
				
					<!-- name change -->
					::if orders[i-1]==null || m.userName != orders[i-1].userName::
						
						<tr>
							<td colspan="8" style="font-size:1.3em;">
								::m.userName:: 
								
								::if m.phone!=null::
								- Téléphone : ::m.phone::
								::end::
							</td>
						</tr>
						<tr>
							<td>Qté</td>
							<td>Réf.</td>
							<td>Produit</td>
							<td>P.U</td>
							<td>Sous-total</td>
							<td>Frais</td>
							<td>Total</td>
							<td>Signature</td>
						</tr>
				
					::end::
				
					<!-- 1 order line -->
					<tr class="order">
						<td>
							::m.quantity:
						</td>
						<td>
							$$nullSafe(::m.productRef::)
						</td>
						<td>
							::m.productName::
						</td>
						<td>
							::formatNum(m.productPrice)::&nbsp;&euro;
						</td>
						<td>
							::formatNum(m.subTotal)::&nbsp;&euro;
						</td>
						<td>
							<!-- frais -->
							::if m.percentageValue!=null::
								::formatNum(m.fees)::&nbsp;&euro;
							::end::
						</td>
						<td>
							<!-- total -->
							::formatNum(m.total)::&nbsp;&euro;
							::set total = total + m.total::
							::set subtotal = subtotal + m.total::
						</td>
						<td style="width:20%;">
							
						</td>
						
					</tr>
				

				
					<!-- member total -->
					::if (orders[i+1]==null || m.userName != orders[i+1].userName) ::
					
						::if subtotal!=0:: 
						<tr style="border-top:2px solid #DDD;">	
							<td colspan="5"></td>
							<th class="text-right">TOTAL</th>
							<th>::formatNum(subtotal)::&nbsp;&euro;</th>					
							<td></td>
							::set subtotal = 0::
						</tr>
						::end::
					::end::
			
				::end::

				
				<!-- big total -->
				<tr style="font-size:1.3em;">					
					<td class="text-right">Total Commande : </td>
					<td>::formatNum(total)::&nbsp;&euro;</td>					
					<td colspan="6"></td>
				</tr>
				
				
				</table>
				
				<p>::raw nl2br(user.getAmap().txtDistrib)::</p>
		
				<p><i>Appuyez sur "Control + P" pour imprimer cette page.</i></p>
</body>
</html>